# Univariate CoR: Cox Proportional Hazards Modeling of Relative and Absolute Risk {#cor-coxph}

```{r cor-coxph-setup, echo = FALSE, message = FALSE}
library(here)
library(latex2exp)
here::i_am("cor_coxph/report.Rmd")
```


The main regression model is the Cox proportional hazards model. All plots are made with Cox models fit unless specified otherwise. The trichotomized variables in Table \ref{tab:CoR_D57_univariable_svycoxph_pretty_\studyname} are defined with respect to inverse probability weighted quantiles computed using the Hmisc::wtd.quantile function.


\begin{table}[H]
\caption{Inference for Day 57 antibody marker covariate-adjusted correlates of risk of COVID in the vaccine group: Hazard ratios per 10-fold increment in the marker*}
\begin{center}
    \input{\pathCoRoutput/CoR_D57_univariable_svycoxph_pretty_\studyname}\\
\end{center}
*Baseline covariates adjusted for: age in years, at risk or not, community of color or not, baseline risk score. Average follow-up time 175 days, maximum follow-up time 185 days.\\
**No. at-risk = number of per-protocol baseline negative vaccine recipients at-risk for COVID at Day 57; no. cases = number of this cohort with an observed COVID endpoints.

    \label{tab:CoR_D57_univariable_svycoxph_pretty_\studyname}
\end{table}


\begin{table}[H]
\caption{Inference for Day 57 antibody marker covariate-adjusted correlates of risk of COVID in the vaccine group: Hazard ratios for Middle vs. Upper tertile vs. Lower tertile*}
\begin{center}
\setlength{\tabcolsep}{.5ex}
\input{\pathCoRoutput/CoR_D57_univariable_svycoxph_cat_pretty_\studyname}\\
\end{center}
*Baseline covariates adjusted for: age in years, at risk or not, community of color or not, baseline risk score. Average follow-up time 175 days, maximum follow-up time 185 days. 
Cutpoints: 
%Day 57 cutpoints: 
\input{\pathCoRoutput/cutpoints_Day57bindSpike_\studyname},  
\input{\pathCoRoutput/cutpoints_Day57bindRBD_\studyname},  
\input{\pathCoRoutput/cutpoints_Day57pseudoneutid50_\studyname},  
\input{\pathCoRoutput/cutpoints_Day57pseudoneutid80_\studyname}.
%fold-rise cutpoints: 
%\input{\pathCoRoutput/cutpoints_Delta57overBbindSpike_\studyname},  
%\input{\pathCoRoutput/cutpoints_Delta57overBbindRBD_\studyname},  
%\input{\pathCoRoutput/cutpoints_Delta57overBpseudoneutid50_\studyname},  
%\input{\pathCoRoutput/cutpoints_Delta57overBpseudoneutid80_\studyname}.  
\\
**No. at-risk = number of per-protocol baseline negative vaccine recipients at-risk for COVID at Day 57; no. cases = number of this cohort with an observed COVID endpoints.\\
***Generalized Wald-test p-value of the null hypothesis that the hazard rate is constant across the Lower, Middle, and Upper tertile groups.

    \label{tab:CoR_D57_univariable_svycoxph_cat_pretty_\studyname}
\end{table}

\clearpage

<!-- \begin{table}[H] -->
<!--     \setlength{\tabcolsep}{.5ex} -->
<!-- \scriptsize{ -->
<!--     \input{\pathCoRoutput/CoR_univariable_svycoxph_\studyname} -->
<!-- } -->
<!-- \caption{CoR models among baseline seronegative vaccine recipients. Each column corresponds to one Cox model fitted by survey::svycoxph.} -->
<!--     \label{tab:CoR_univariable_svycoxph_\studyname} -->
<!-- \end{table} -->


\begin{table}[H]
    \setlength{\tabcolsep}{.5ex}
    \input{\pathCoRoutput/CoR_Day57pseudoneutid80_sens_noCases_\studyname}
\caption{CoR models for Day 57 pseudo neut ID80 among baseline seronegative vaccine recipients. Each row corresponds to one Cox model fitted by survey::svycoxph.For each model, a different dataset that keeps a random subset of the cases is used. The original dataset has 66 cases.}
    \label{tab:CoR_Day57pseudoneutid80_sens_noCases_\studyname}
\end{table}

\begin{table}[H]
    \setlength{\tabcolsep}{.5ex}
    \input{\pathCoRoutput/CoR_Day57pseudoneutid80_5cases_\studyname}
\caption{CoR models for Day 57 pseudo neut ID80 among baseline seronegative vaccine recipients. Each row corresponds to one Cox model fitted by survey::svycoxph.For each model, a different dataset that keeps a random subset of 5 cases is used.}
    \label{tab:CoR_Day57pseudoneutid80_5cases_\studyname}
\end{table}


<!-- \begin{table}[H] -->
<!--     \input{\pathCoRoutput/CoR_univariable_tps} -->
<!--     \caption{CoR models among baseline seronegative vaccine recipients. Each column corresponds to one logistic regression model fitted by osDesign::tps. } -->
<!--     \label{tab:CoR_univariable_tps} -->
<!-- \end{table} -->

<!-- \begin{table}[H] -->
<!--     \input{\pathCoRoutput/CoR_univariable_hingelogistic} -->
<!--     \caption{CoR models among baseline seronegative vaccine recipients. Each column corresponds to one logistic regression model with hinge fitted by chgnpt::chngptm. } -->
<!--     \label{tab:CoR_univariable_hingelogistic} -->
<!-- \end{table} -->



\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/marginalized_risks_woplacebo_\studyname}
    \caption{Marginalized cumulative risk by Day \protect\input{\pathCoRoutput/timepoints_cum_risk_\studyname} as functions of Day 57 markers among baseline seronegative vaccine recipients with 95\% bootstrap confidence bands. The horizontal lines indicate the overall cumulative risk of the vaccine arm by Day \protect\input{\pathCoRoutput/timepoints_cum_risk_\studyname} and its 95\% confidence interval. Histograms of the immunological markers in the vaccine arm are overlayed.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/marginalized_risks_\studyname}
    \caption{Marginalized cumulative risk by Day \protect\input{\pathCoRoutput/timepoints_cum_risk_\studyname} as functions of Day 57 markers among baseline seronegative vaccine recipients with 95\% bootstrap confidence bands. The horizontal lines indicate the overall cumulative risk of the placebo and vaccine arms by Day \protect\input{\pathCoRoutput/timepoints_cum_risk_\studyname} and its 95\% confidence interval. Histograms of the immunological markers in the vaccine arm are overlayed.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/controlled_ve_curves_\studyname}
    \caption{Controlled VE with sensitivity analysis as functions of Day 57 markers among baseline seronegative vaccine recipients with 95\% bootstrap confidence bands. Histograms of the immunological markers in the vaccine arm are overlayed.}
\end{figure}



\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/marginalized_risks_cat_\studyname}
    \caption{Marginalized cumulative incidence rate curves for trichotomized Day 57 markers among baseline seronegative vaccine recipients. The gray line is the overall cumulative incidence rate curve in the placebo arm.}
\end{figure}




\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_bindSpike_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 binding Ab to spike markers among baseline seronegative vaccine recipients (top row) and each of the 8 strata within (row 2-9) with 95\% confidence intervals.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_bindRBD_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 binding Ab to RBD markers among baseline seronegative vaccine recipients (top row) and each of the 8 strata within (row 2-9) with 95\% confidence intervals.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_pseudoneutid50_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 pseudo neut ID50 markers among baseline seronegative vaccine recipients (top row) and each of the 8 strata within (row 2-9) with 95\% confidence intervals.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_pseudoneutid80_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 pseudo neut ID80 markers among baseline seronegative vaccine recipients (top row) and each of the 8 strata within (row 2-9) with 95\% confidence intervals.}
\end{figure}

<!-- \begin{figure}[H] -->
<!--     \centering -->
<!--     \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_liveneutid80_\studyname} -->
<!--     \caption{Forest plots of hazard ratios of Day 57 live neut ID80 markers among baseline seronegative vaccine recipients (top row) and each of the 8 strata within (row 2-9) with 95\% confidence intervals.} -->
<!-- \end{figure} -->


\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_marginal_bindSpike_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 binding Ab to spike markers among baseline seronegative vaccine recipients (top row) and eight subpopulations (row 2-9) with 95\% confidence intervals.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_marginal_bindRBD_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 binding Ab to RBD markers among baseline seronegative vaccine recipients (top row) and eight subpopulations (row 2-9) with 95\% confidence intervals.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_marginal_pseudoneutid50_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 pseudo neut ID50 markers among baseline seronegative vaccine recipients (top row) and eight subpopulations (row 2-9) with 95\% confidence intervals.}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_marginal_pseudoneutid80_\studyname}
    \caption{Forest plots of hazard ratios of Day 57 pseudo neut ID80 markers among baseline seronegative vaccine recipients (top row) and eight subpopulations (row 2-9) with 95\% confidence intervals.}
\end{figure}

<!-- \begin{figure}[H] -->
<!--     \centering -->
<!--     \includegraphics[width=1\textwidth]{\pathCoRoutput/hr_forest_marginal_liveneutid80_\studyname} -->
<!--     \caption{Forest plots of hazard ratios of Day 57 live neut ID80 markers among baseline seronegative vaccine recipients (top row) and eight subpopulations (row 2-9) with 95\% confidence intervals.} -->
<!-- \end{figure} -->



\clearpage
### Nonlinear association

To explore nonlinear association and threshold modeling, we first fit smoothing spline using the mgcv R package. The estimated degree of freedom is 1, and the fitted curve is shown in Figure \@ref(fig:gam_\studyname). The results suggest no nonlinear trend.

\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{\pathCoRoutput/gam_\studyname}
    \caption{GAM fit of risk of infection versus markers. Clinical covariates are adjusted, weights are ignored.}
    \label{fig:gam_\studyname}
\end{figure}


<!-- We also fit a loess curve and the results are shown in Figure \@ref(fig:binaryloess).  -->
<!-- \begin{figure}[H] -->
<!--     \centering -->
<!--     \includegraphics[width=1\textwidth]{\pathCoRoutput/binaryloess_\studyname} -->
<!--     \caption{Loess fit of risk of infection versus markers. No clinical covariates are adjusted, weights are passed to the loess function.} -->
<!--     \label{fig:binaryloess_\studyname} -->
<!-- \end{figure} -->
